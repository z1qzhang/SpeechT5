nohup: ignoring input
2023-06-05 13:00:35 | INFO | fairseq_cli.generate | {'_name': None, 'common': {'_name': None, 'no_progress_bar': False, 'log_interval': 100, 'log_format': None, 'log_file': None, 'tensorboard_logdir': None, 'wandb_project': None, 'azureml_logging': False, 'seed': 1, 'cpu': False, 'tpu': False, 'bf16': False, 'memory_efficient_bf16': False, 'fp16': False, 'memory_efficient_fp16': False, 'fp16_no_flatten_grads': False, 'fp16_init_scale': 128, 'fp16_scale_window': None, 'fp16_scale_tolerance': 0.0, 'on_cpu_convert_precision': False, 'min_loss_scale': 0.0001, 'threshold_loss_scale': None, 'amp': False, 'amp_batch_retries': 2, 'amp_init_scale': 128, 'amp_scale_window': None, 'user_dir': '/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm', 'empty_cache_freq': 0, 'all_gather_list_size': 16384, 'model_parallel_size': 1, 'quantization_config_path': None, 'profile': False, 'reset_logging': False, 'suppress_crashes': False, 'use_plasma_view': False, 'plasma_path': '/tmp/plasma'}, 'common_eval': {'_name': None, 'path': '/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enar_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt', 'post_process': None, 'quiet': False, 'model_overrides': "{'w2v_path':'/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm/config/pretrain/speechlmp_base_cfg.pt'}", 'results_path': '/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enar_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test'}, 'distributed_training': {'_name': None, 'distributed_world_size': 1, 'distributed_num_procs': 1, 'distributed_rank': 0, 'distributed_backend': 'nccl', 'distributed_init_method': None, 'distributed_port': -1, 'device_id': 0, 'distributed_no_spawn': False, 'ddp_backend': 'pytorch_ddp', 'ddp_comm_hook': 'none', 'bucket_cap_mb': 25, 'fix_batches_to_gpus': False, 'find_unused_parameters': False, 'gradient_as_bucket_view': False, 'fast_stat_sync': False, 'heartbeat_timeout': -1, 'broadcast_buffers': False, 'slowmo_momentum': None, 'slowmo_base_algorithm': 'localsgd', 'localsgd_frequency': 3, 'nprocs_per_node': 1, 'pipeline_model_parallel': False, 'pipeline_balance': None, 'pipeline_devices': None, 'pipeline_chunks': 0, 'pipeline_encoder_balance': None, 'pipeline_encoder_devices': None, 'pipeline_decoder_balance': None, 'pipeline_decoder_devices': None, 'pipeline_checkpoint': 'never', 'zero_sharding': 'none', 'fp16': False, 'memory_efficient_fp16': False, 'tpu': False, 'no_reshard_after_forward': False, 'fp32_reduce_scatter': False, 'cpu_offload': False, 'use_sharded_state': False, 'not_fsdp_flatten_parameters': False}, 'dataset': {'_name': None, 'num_workers': 0, 'skip_invalid_size_inputs_valid_test': False, 'max_tokens': 2300000, 'batch_size': None, 'required_batch_size_multiple': 8, 'required_seq_len_multiple': 1, 'dataset_impl': None, 'data_buffer_size': 10, 'train_subset': 'train', 'valid_subset': 'valid', 'combine_valid_subsets': None, 'ignore_unused_valid_subsets': False, 'validate_interval': 1, 'validate_interval_updates': 0, 'validate_after_updates': 0, 'fixed_validation_seed': None, 'disable_validation': False, 'max_tokens_valid': 2300000, 'batch_size_valid': None, 'max_valid_steps': None, 'curriculum': 0, 'gen_subset': 'test_st_en_ar_local', 'num_shards': 1, 'shard_id': 0, 'grouped_shuffling': False, 'update_epoch_batch_itr': False, 'update_ordered_indices_seed': False}, 'optimization': {'_name': None, 'max_epoch': 0, 'max_update': 0, 'stop_time_hours': 0.0, 'clip_norm': 0.0, 'sentence_avg': False, 'update_freq': [1], 'lr': [0.25], 'stop_min_lr': -1.0, 'use_bmuf': False, 'skip_remainder_batch': False}, 'checkpoint': {'_name': None, 'save_dir': 'checkpoints', 'restore_file': 'checkpoint_last.pt', 'continue_once': None, 'finetune_from_model': None, 'reset_dataloader': False, 'reset_lr_scheduler': False, 'reset_meters': False, 'reset_optimizer': False, 'optimizer_overrides': '{}', 'save_interval': 1, 'save_interval_updates': 0, 'keep_interval_updates': -1, 'keep_interval_updates_pattern': -1, 'keep_last_epochs': -1, 'keep_best_checkpoints': -1, 'no_save': False, 'no_epoch_checkpoints': False, 'no_last_checkpoints': False, 'no_save_optimizer_state': False, 'best_checkpoint_metric': 'loss', 'maximize_best_checkpoint_metric': False, 'patience': -1, 'checkpoint_suffix': '', 'checkpoint_shard_count': 1, 'load_checkpoint_on_all_dp_ranks': False, 'write_checkpoints_asynchronously': False, 'model_parallel_size': 1}, 'bmuf': {'_name': None, 'block_lr': 1.0, 'block_momentum': 0.875, 'global_sync_iter': 50, 'warmup_iterations': 500, 'use_nbm': False, 'average_sync': False, 'distributed_world_size': 1}, 'generation': {'_name': None, 'beam': 5, 'nbest': 1, 'max_len_a': 0.0, 'max_len_b': 512, 'min_len': 1, 'match_source_len': False, 'unnormalized': False, 'no_early_stop': False, 'no_beamable_mm': False, 'lenpen': 1.0, 'unkpen': 0.0, 'replace_unk': None, 'sacrebleu': False, 'score_reference': False, 'prefix_size': 0, 'no_repeat_ngram_size': 0, 'sampling': False, 'sampling_topk': -1, 'sampling_topp': -1.0, 'constraints': None, 'temperature': 1.0, 'diverse_beam_groups': -1, 'diverse_beam_strength': 0.5, 'diversity_rate': -1.0, 'print_alignment': None, 'print_step': False, 'lm_path': None, 'lm_weight': 0.0, 'iter_decode_eos_penalty': 0.0, 'iter_decode_max_iter': 10, 'iter_decode_force_max_iter': False, 'iter_decode_with_beam': 1, 'iter_decode_with_external_reranker': False, 'retain_iter_history': False, 'retain_dropout': False, 'retain_dropout_modules': None, 'decoding_format': None, 'no_seed_provided': False}, 'eval_lm': {'_name': None, 'output_word_probs': False, 'output_word_stats': False, 'context_window': 0, 'softmax_batch': 9223372036854775807}, 'interactive': {'_name': None, 'buffer_size': 0, 'input': '-'}, 'model': {'_name': 'wav2vec2', 'extractor_mode': 'default', 'encoder_layers': 12, 'encoder_embed_dim': 768, 'encoder_ffn_embed_dim': 3072, 'encoder_attention_heads': 12, 'activation_fn': 'gelu', 'layer_type': 'transformer', 'dropout': 0.1, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'encoder_layerdrop': 0.0, 'dropout_input': 0.0, 'dropout_features': 0.0, 'final_dim': 0, 'layer_norm_first': False, 'conv_feature_layers': '[(512, 10, 5)] + [(512, 3, 2)] * 4 + [(512,2,2)] + [(512,2,2)]', 'conv_bias': False, 'logit_temp': 0.1, 'quantize_targets': False, 'quantize_input': False, 'same_quantizer': False, 'target_glu': False, 'feature_grad_mult': 1.0, 'quantizer_depth': 1, 'quantizer_factor': 3, 'latent_vars': 320, 'latent_groups': 2, 'latent_dim': 0, 'mask_length': 10, 'mask_prob': 0.65, 'mask_selection': 'static', 'mask_other': 0.0, 'no_mask_overlap': False, 'mask_min_space': 1, 'require_same_masks': True, 'mask_dropout': 0.0, 'mask_channel_length': 10, 'mask_channel_prob': 0.0, 'mask_channel_before': False, 'mask_channel_selection': 'static', 'mask_channel_other': 0.0, 'no_mask_channel_overlap': False, 'mask_channel_min_space': 1, 'num_negatives': 100, 'negatives_from_everywhere': False, 'cross_sample_negatives': 0, 'codebook_negatives': 0, 'conv_pos': 128, 'conv_pos_groups': 16, 'pos_conv_depth': 1, 'latent_temp': [2.0, 0.5, 0.999995], 'max_positions': 100000, 'checkpoint_activations': False, 'required_seq_len_multiple': 1, 'crop_seq_to_multiple': 1, 'depthwise_conv_kernel_size': 31, 'attn_type': '', 'pos_enc_type': 'abs', 'fp16': False}, 'task': Namespace(_name='speech_to_text', all_gather_list_size=16384, amp=False, amp_batch_retries=2, amp_init_scale=128, amp_scale_window=None, arch='wav2vec2', azureml_logging=False, batch_size=None, batch_size_valid=None, beam=5, best_checkpoint_metric='loss', bf16=False, bpe=None, broadcast_buffers=False, bucket_cap_mb=25, checkpoint_shard_count=1, checkpoint_suffix='', combine_valid_subsets=None, config_yaml='config_base_enar.yaml', constraints=None, continue_once=None, cpu=False, cpu_offload=False, criterion='cross_entropy', curriculum=0, data='/LocalData/dataset/CommonVoice/v4/en/en-ar', data_buffer_size=10, dataset_impl=None, ddp_backend='pytorch_ddp', ddp_comm_hook='none', decoding_format=None, device_id=0, disable_validation=False, distributed_backend='nccl', distributed_init_method=None, distributed_no_spawn=False, distributed_num_procs=1, distributed_port=-1, distributed_rank=0, distributed_world_size=1, diverse_beam_groups=-1, diverse_beam_strength=0.5, diversity_rate=-1.0, empty_cache_freq=0, fast_stat_sync=False, find_unused_parameters=False, finetune_from_model=None, fix_batches_to_gpus=False, fixed_validation_seed=None, force_anneal=None, fp16=False, fp16_init_scale=128, fp16_no_flatten_grads=False, fp16_scale_tolerance=0.0, fp16_scale_window=None, fp32_reduce_scatter=False, gen_subset='test_st_en_ar_local', gradient_as_bucket_view=False, grouped_shuffling=False, heartbeat_timeout=-1, ignore_unused_valid_subsets=False, iter_decode_eos_penalty=0.0, iter_decode_force_max_iter=False, iter_decode_max_iter=10, iter_decode_with_beam=1, iter_decode_with_external_reranker=False, keep_best_checkpoints=-1, keep_interval_updates=-1, keep_interval_updates_pattern=-1, keep_last_epochs=-1, lenpen=1.0, lm_path=None, lm_weight=0.0, load_checkpoint_on_all_dp_ranks=False, localsgd_frequency=3, log_file=None, log_format=None, log_interval=100, lr_scheduler='fixed', lr_shrink=0.1, match_source_len=False, max_len_a=0.0, max_len_b=512, max_source_positions=2300000, max_target_positions=1024, max_tokens=2300000, max_tokens_valid=2300000, max_valid_steps=None, maximize_best_checkpoint_metric=False, memory_efficient_bf16=False, memory_efficient_fp16=False, min_len=1, min_loss_scale=0.0001, model_overrides="{'w2v_path':'/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm/config/pretrain/speechlmp_base_cfg.pt'}", model_parallel_size=1, nbest=1, no_beamable_mm=False, no_early_stop=False, no_epoch_checkpoints=False, no_last_checkpoints=False, no_progress_bar=False, no_repeat_ngram_size=0, no_reshard_after_forward=False, no_save=False, no_save_optimizer_state=False, no_seed_provided=False, not_fsdp_flatten_parameters=False, nprocs_per_node=1, num_shards=1, num_workers=0, on_cpu_convert_precision=False, optimizer=None, optimizer_overrides='{}', path='/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enar_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt', patience=-1, pipeline_balance=None, pipeline_checkpoint='never', pipeline_chunks=0, pipeline_decoder_balance=None, pipeline_decoder_devices=None, pipeline_devices=None, pipeline_encoder_balance=None, pipeline_encoder_devices=None, pipeline_model_parallel=False, plasma_path='/tmp/plasma', post_process=None, prefix_size=0, print_alignment=None, print_step=False, profile=False, quantization_config_path=None, quiet=False, replace_unk=None, required_batch_size_multiple=8, required_seq_len_multiple=1, reset_dataloader=False, reset_logging=False, reset_lr_scheduler=False, reset_meters=False, reset_optimizer=False, restore_file='checkpoint_last.pt', results_path='/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enar_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test', retain_dropout=False, retain_dropout_modules=None, retain_iter_history=False, sacrebleu=False, sacrebleu_char_level=False, sacrebleu_lowercase=False, sacrebleu_tokenizer='13a', sampling=False, sampling_topk=-1, sampling_topp=-1.0, save_dir='checkpoints', save_interval=1, save_interval_updates=0, score_reference=False, scoring='sacrebleu', seed=1, shard_id=0, simul_type=None, skip_invalid_size_inputs_valid_test=False, slowmo_base_algorithm='localsgd', slowmo_momentum=None, suppress_crashes=False, task='speech_to_text', temperature=1.0, tensorboard_logdir=None, threshold_loss_scale=None, tokenizer=None, tpu=False, train_subset='train', unkpen=0, unnormalized=False, update_epoch_batch_itr=False, update_ordered_indices_seed=False, use_plasma_view=False, use_sharded_state=False, user_dir='/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm', valid_subset='valid', validate_after_updates=0, validate_interval=1, validate_interval_updates=0, wandb_project=None, warmup_updates=0, write_checkpoints_asynchronously=False, zero_sharding='none'), 'criterion': {'_name': 'cross_entropy', 'sentence_avg': True}, 'optimizer': None, 'lr_scheduler': {'_name': 'fixed', 'force_anneal': None, 'lr_shrink': 0.1, 'warmup_updates': 0, 'lr': [0.25]}, 'scoring': {'_name': 'sacrebleu', 'sacrebleu_tokenizer': '13a', 'sacrebleu_lowercase': False, 'sacrebleu_char_level': False}, 'bpe': None, 'tokenizer': None, 'ema': {'_name': None, 'store_ema': False, 'ema_decay': 0.9999, 'ema_start_update': 0, 'ema_seed_model': None, 'ema_update_freq': 1, 'ema_fp32': False}, 'simul_type': None}
2023-06-05 13:00:35 | INFO | fairseq.tasks.speech_to_text | dictionary size (spm_char_st_en_ar.txt): 208
2023-06-05 13:00:35 | INFO | fairseq_cli.generate | loading model(s) from /home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enar_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt
2023-06-05 13:00:44 | INFO | speechlm.tasks.joint_sc2t_pretrain | current directory is /home/ziqzhang/code/SpeechT5/SpeechLM
2023-06-05 13:00:44 | INFO | speechlm.tasks.joint_sc2t_pretrain | JSTPretrainingTask Config {'_name': 'joint_sc2t_pretraining', 'data': '/LocalData/dataset/CommonVoice/v4/en/en-ar', 'fine_tuning': False, 'labels': ['phn'], 'label_dir': '/home/ziqzhang/code/SpeechT5/SpeechLM/dataset/LibriSpeech/phone_unit', 'label_rate': 100, 'sample_rate': 16000, 'normalize': False, 'enable_padding': False, 'max_keep_size': None, 'max_sample_size': 250000, 'min_sample_size': 32000, 'single_target': False, 'random_crop': True, 'pad_audio': False, 'store_labels': True, 'add_decoder_target': False, 'split_modality_batch': False, 'speech_tgt_lang': '', 'speech_sampling_alpha': 0.2, 'text_sampling_alpha': 0.2, 'hubert_tokenizer': none, 'sp_path': None, 'text_cfg': {'_name': None, 'text_data': '/home/ziqzhang/code/SpeechT5/SpeechLM/dataset/LibriLM/phone_unit/bin-idx', 'seed': 1337, 'tokens_per_sample': 1024, 'tokens_per_sample_tgt': 512, 'sample_break_mode': 'eos', 'mask': 0.3, 'leave_unmasked_prob': 0.1, 'mask_random': 0.1, 'freq_weighted_replacement': False, 'mask_whole_words': True, 'mask_repeative_tokens': True, 'mask_multiple_length': 1, 'mask_stdev': 0.0, 'shorten_method': 'random_crop', 'shorten_data_split_list': '', 'insert': 0.0, 'permute': 0.0, 'rotate': 0.0, 'poisson_lambda': 3.5, 'permute_sentences': 0.0, 'mask_length': '10', 'replace_length': 1, 'shuffle_instance': False, 'max_source_positions': 1024, 'max_target_positions': 1024, 'bpe': '', 'data_config': 'config.yaml', 'text_maxtokens_ratio': 1.0, 'prepend_tgt_lang_tag': False, 'mask_text_ratio': 0.0, 'truncate_mono_source': True}}
2023-06-05 13:00:45 | INFO | speechlm.models.speechlm | SpeechlmModel Config: {'_name': 'speechlm', 'label_rate': 100, 'extractor_mode': default, 'encoder_layers': 6, 'encoder_embed_dim': 768, 'encoder_ffn_embed_dim': 3072, 'encoder_attention_heads': 8, 'activation_fn': gelu, 'layer_type': transformer, 'dropout': 0.0, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'encoder_layerdrop': 0.1, 'dropout_input': 0.0, 'dropout_features': 0.1, 'final_dim': 256, 'untie_final_proj': True, 'layer_norm_first': False, 'conv_feature_layers': '[(512,10,5)] + [(512,3,2)] * 4 + [(512,2,2)] * 2', 'conv_bias': False, 'logit_temp': 0.1, 'target_glu': False, 'feature_grad_mult': 1.0, 'mask_length': 10, 'mask_prob': 0.5, 'mask_selection': static, 'mask_other': 0.0, 'no_mask_overlap': False, 'mask_min_space': 1, 'mask_channel_length': 10, 'mask_channel_prob': 0.0, 'mask_channel_selection': static, 'mask_channel_other': 0.0, 'no_mask_channel_overlap': False, 'mask_channel_min_space': 1, 'conv_pos': 128, 'conv_pos_groups': 16, 'latent_temp': [2.0, 0.5, 0.999995], 'skip_masked': False, 'skip_nomask': False, 'checkpoint_activations': False, 'required_seq_len_multiple': 2, 'depthwise_conv_kernel_size': 31, 'attn_type': '', 'pos_enc_type': 'abs', 'fp16': False, 'use_rel_pos_enc': True, 'scaling_for_att': 1.0, 'text_transformer': {'_name': None, 'activation_fn': gelu, 'dropout': 0.0, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'adaptive_input': False, 'encoder': {'_name': None, 'embed_path': None, 'embed_dim': 768, 'ffn_embed_dim': 3072, 'layers': 6, 'attention_heads': 8, 'normalize_before': False, 'learned_pos': True, 'layerdrop': 0.1, 'layers_to_keep': None}, 'max_source_positions': 3000, 'decoder': {'_name': None, 'embed_path': None, 'embed_dim': 512, 'ffn_embed_dim': 2048, 'layers': 6, 'attention_heads': 8, 'normalize_before': False, 'learned_pos': False, 'layerdrop': 0.0, 'layers_to_keep': None, 'input_dim': 512, 'output_dim': 512}, 'max_target_positions': 1024, 'share_decoder_input_output_embed': False, 'share_all_embeddings': False, 'no_token_positional_embeddings': False, 'adaptive_softmax_cutoff': None, 'adaptive_softmax_dropout': 0.0, 'adaptive_softmax_factor': 4.0, 'layernorm_embedding': True, 'tie_adaptive_weights': False, 'tie_adaptive_proj': False, 'no_scale_embedding': True, 'checkpoint_activations': False, 'offload_activations': False, 'no_cross_attention': False, 'cross_self_attention': False, 'quant_noise': {'_name': None, 'pq': 0.0, 'pq_block_size': 8, 'scalar': 0.0}, 'min_params_to_wrap': 100000000, 'char_inputs': False, 'relu_dropout': 0.0, 'base_layers': 0, 'base_sublayers': 1, 'base_shuffle': 1, 'export': False, 'no_decoder_final_norm': False}, 'add_unit_encoder': True, 'add_decoder': False, 'add_text_ctc': True, 'text_ctc_conv_kernel': 2, 'mask_u2t': True, 'compute_mum': False, 'mix_with_unit': True, 'use_pred_unit': False, 'l2_embedding': False, 'encoder_dict_size': -1, 'decoder_dict_size': -1}
2023-06-05 13:00:48 | INFO | fairseq.tasks.speech_to_text | pre-tokenizer: {'tokenizer': None}
2023-06-05 13:00:48 | INFO | fairseq.tasks.speech_to_text | tokenizer: {'bpe': 'sentencepiece', 'sentencepiece_model': '/LocalData/dataset/CommonVoice/v4/en/en-ar/spm_char_st_en_ar.model'}
2023-06-05 13:00:49 | INFO | fairseq.data.audio.speech_to_text_dataset | 'test_st_en_ar_local' has 0.00% OOV
2023-06-05 13:00:49 | INFO | fairseq.data.audio.speech_to_text_dataset | SpeechToTextDataset(split="test_st_en_ar_local", n_samples=15_530, prepend_tgt_lang_tag=False, shuffle=False, transforms=None, n_frames_per_step=1
2023-06-05 13:00:51 | INFO | fairseq.tasks.speech_to_text | pre-tokenizer: {'tokenizer': None}
2023-06-05 13:00:51 | INFO | fairseq.tasks.speech_to_text | tokenizer: {'bpe': 'sentencepiece', 'sentencepiece_model': '/LocalData/dataset/CommonVoice/v4/en/en-ar/spm_char_st_en_ar.model'}
2023-06-05 13:02:59 | INFO | fairseq.logging.progress_bar | :    101 / 775 wps=351
2023-06-05 13:05:16 | INFO | fairseq.logging.progress_bar | :    201 / 775 wps=473
2023-06-05 13:07:32 | INFO | fairseq.logging.progress_bar | :    301 / 775 wps=536
2023-06-05 13:09:57 | INFO | fairseq.logging.progress_bar | :    401 / 775 wps=549
2023-06-05 13:12:00 | INFO | fairseq.logging.progress_bar | :    501 / 775 wps=590
2023-06-05 13:13:57 | INFO | fairseq.logging.progress_bar | :    601 / 775 wps=632
2023-06-05 13:15:51 | INFO | fairseq.logging.progress_bar | :    701 / 775 wps=666
2023-06-05 13:17:02 | INFO | fairseq_cli.generate | NOTE: hypothesis and token scores are output in base 2
2023-06-05 13:17:02 | INFO | fairseq_cli.generate | Translated 15,530 sentences (676,822 tokens) in 912.4s (17.02 sentences/s, 741.77 tokens/s)
/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enar_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test
Generate test_st_en_ar_local with beam=5: BLEU = 18.15 48.9/23.8/13.5/7.8 (BP = 0.970 ratio = 0.970 hyp_len = 130474 ref_len = 134506)
2023-06-05 13:17:08 | INFO | fairseq_cli.generate | {'_name': None, 'common': {'_name': None, 'no_progress_bar': False, 'log_interval': 100, 'log_format': None, 'log_file': None, 'tensorboard_logdir': None, 'wandb_project': None, 'azureml_logging': False, 'seed': 1, 'cpu': False, 'tpu': False, 'bf16': False, 'memory_efficient_bf16': False, 'fp16': False, 'memory_efficient_fp16': False, 'fp16_no_flatten_grads': False, 'fp16_init_scale': 128, 'fp16_scale_window': None, 'fp16_scale_tolerance': 0.0, 'on_cpu_convert_precision': False, 'min_loss_scale': 0.0001, 'threshold_loss_scale': None, 'amp': False, 'amp_batch_retries': 2, 'amp_init_scale': 128, 'amp_scale_window': None, 'user_dir': '/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm', 'empty_cache_freq': 0, 'all_gather_list_size': 16384, 'model_parallel_size': 1, 'quantization_config_path': None, 'profile': False, 'reset_logging': False, 'suppress_crashes': False, 'use_plasma_view': False, 'plasma_path': '/tmp/plasma'}, 'common_eval': {'_name': None, 'path': '/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enca_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt', 'post_process': None, 'quiet': False, 'model_overrides': "{'w2v_path':'/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm/config/pretrain/speechlmp_base_cfg.pt'}", 'results_path': '/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enca_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test'}, 'distributed_training': {'_name': None, 'distributed_world_size': 1, 'distributed_num_procs': 1, 'distributed_rank': 0, 'distributed_backend': 'nccl', 'distributed_init_method': None, 'distributed_port': -1, 'device_id': 0, 'distributed_no_spawn': False, 'ddp_backend': 'pytorch_ddp', 'ddp_comm_hook': 'none', 'bucket_cap_mb': 25, 'fix_batches_to_gpus': False, 'find_unused_parameters': False, 'gradient_as_bucket_view': False, 'fast_stat_sync': False, 'heartbeat_timeout': -1, 'broadcast_buffers': False, 'slowmo_momentum': None, 'slowmo_base_algorithm': 'localsgd', 'localsgd_frequency': 3, 'nprocs_per_node': 1, 'pipeline_model_parallel': False, 'pipeline_balance': None, 'pipeline_devices': None, 'pipeline_chunks': 0, 'pipeline_encoder_balance': None, 'pipeline_encoder_devices': None, 'pipeline_decoder_balance': None, 'pipeline_decoder_devices': None, 'pipeline_checkpoint': 'never', 'zero_sharding': 'none', 'fp16': False, 'memory_efficient_fp16': False, 'tpu': False, 'no_reshard_after_forward': False, 'fp32_reduce_scatter': False, 'cpu_offload': False, 'use_sharded_state': False, 'not_fsdp_flatten_parameters': False}, 'dataset': {'_name': None, 'num_workers': 0, 'skip_invalid_size_inputs_valid_test': False, 'max_tokens': 2300000, 'batch_size': None, 'required_batch_size_multiple': 8, 'required_seq_len_multiple': 1, 'dataset_impl': None, 'data_buffer_size': 10, 'train_subset': 'train', 'valid_subset': 'valid', 'combine_valid_subsets': None, 'ignore_unused_valid_subsets': False, 'validate_interval': 1, 'validate_interval_updates': 0, 'validate_after_updates': 0, 'fixed_validation_seed': None, 'disable_validation': False, 'max_tokens_valid': 2300000, 'batch_size_valid': None, 'max_valid_steps': None, 'curriculum': 0, 'gen_subset': 'test_st_en_ca_local', 'num_shards': 1, 'shard_id': 0, 'grouped_shuffling': False, 'update_epoch_batch_itr': False, 'update_ordered_indices_seed': False}, 'optimization': {'_name': None, 'max_epoch': 0, 'max_update': 0, 'stop_time_hours': 0.0, 'clip_norm': 0.0, 'sentence_avg': False, 'update_freq': [1], 'lr': [0.25], 'stop_min_lr': -1.0, 'use_bmuf': False, 'skip_remainder_batch': False}, 'checkpoint': {'_name': None, 'save_dir': 'checkpoints', 'restore_file': 'checkpoint_last.pt', 'continue_once': None, 'finetune_from_model': None, 'reset_dataloader': False, 'reset_lr_scheduler': False, 'reset_meters': False, 'reset_optimizer': False, 'optimizer_overrides': '{}', 'save_interval': 1, 'save_interval_updates': 0, 'keep_interval_updates': -1, 'keep_interval_updates_pattern': -1, 'keep_last_epochs': -1, 'keep_best_checkpoints': -1, 'no_save': False, 'no_epoch_checkpoints': False, 'no_last_checkpoints': False, 'no_save_optimizer_state': False, 'best_checkpoint_metric': 'loss', 'maximize_best_checkpoint_metric': False, 'patience': -1, 'checkpoint_suffix': '', 'checkpoint_shard_count': 1, 'load_checkpoint_on_all_dp_ranks': False, 'write_checkpoints_asynchronously': False, 'model_parallel_size': 1}, 'bmuf': {'_name': None, 'block_lr': 1.0, 'block_momentum': 0.875, 'global_sync_iter': 50, 'warmup_iterations': 500, 'use_nbm': False, 'average_sync': False, 'distributed_world_size': 1}, 'generation': {'_name': None, 'beam': 5, 'nbest': 1, 'max_len_a': 0.0, 'max_len_b': 512, 'min_len': 1, 'match_source_len': False, 'unnormalized': False, 'no_early_stop': False, 'no_beamable_mm': False, 'lenpen': 1.0, 'unkpen': 0.0, 'replace_unk': None, 'sacrebleu': False, 'score_reference': False, 'prefix_size': 0, 'no_repeat_ngram_size': 0, 'sampling': False, 'sampling_topk': -1, 'sampling_topp': -1.0, 'constraints': None, 'temperature': 1.0, 'diverse_beam_groups': -1, 'diverse_beam_strength': 0.5, 'diversity_rate': -1.0, 'print_alignment': None, 'print_step': False, 'lm_path': None, 'lm_weight': 0.0, 'iter_decode_eos_penalty': 0.0, 'iter_decode_max_iter': 10, 'iter_decode_force_max_iter': False, 'iter_decode_with_beam': 1, 'iter_decode_with_external_reranker': False, 'retain_iter_history': False, 'retain_dropout': False, 'retain_dropout_modules': None, 'decoding_format': None, 'no_seed_provided': False}, 'eval_lm': {'_name': None, 'output_word_probs': False, 'output_word_stats': False, 'context_window': 0, 'softmax_batch': 9223372036854775807}, 'interactive': {'_name': None, 'buffer_size': 0, 'input': '-'}, 'model': {'_name': 'wav2vec2', 'extractor_mode': 'default', 'encoder_layers': 12, 'encoder_embed_dim': 768, 'encoder_ffn_embed_dim': 3072, 'encoder_attention_heads': 12, 'activation_fn': 'gelu', 'layer_type': 'transformer', 'dropout': 0.1, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'encoder_layerdrop': 0.0, 'dropout_input': 0.0, 'dropout_features': 0.0, 'final_dim': 0, 'layer_norm_first': False, 'conv_feature_layers': '[(512, 10, 5)] + [(512, 3, 2)] * 4 + [(512,2,2)] + [(512,2,2)]', 'conv_bias': False, 'logit_temp': 0.1, 'quantize_targets': False, 'quantize_input': False, 'same_quantizer': False, 'target_glu': False, 'feature_grad_mult': 1.0, 'quantizer_depth': 1, 'quantizer_factor': 3, 'latent_vars': 320, 'latent_groups': 2, 'latent_dim': 0, 'mask_length': 10, 'mask_prob': 0.65, 'mask_selection': 'static', 'mask_other': 0.0, 'no_mask_overlap': False, 'mask_min_space': 1, 'require_same_masks': True, 'mask_dropout': 0.0, 'mask_channel_length': 10, 'mask_channel_prob': 0.0, 'mask_channel_before': False, 'mask_channel_selection': 'static', 'mask_channel_other': 0.0, 'no_mask_channel_overlap': False, 'mask_channel_min_space': 1, 'num_negatives': 100, 'negatives_from_everywhere': False, 'cross_sample_negatives': 0, 'codebook_negatives': 0, 'conv_pos': 128, 'conv_pos_groups': 16, 'pos_conv_depth': 1, 'latent_temp': [2.0, 0.5, 0.999995], 'max_positions': 100000, 'checkpoint_activations': False, 'required_seq_len_multiple': 1, 'crop_seq_to_multiple': 1, 'depthwise_conv_kernel_size': 31, 'attn_type': '', 'pos_enc_type': 'abs', 'fp16': False}, 'task': Namespace(_name='speech_to_text', all_gather_list_size=16384, amp=False, amp_batch_retries=2, amp_init_scale=128, amp_scale_window=None, arch='wav2vec2', azureml_logging=False, batch_size=None, batch_size_valid=None, beam=5, best_checkpoint_metric='loss', bf16=False, bpe=None, broadcast_buffers=False, bucket_cap_mb=25, checkpoint_shard_count=1, checkpoint_suffix='', combine_valid_subsets=None, config_yaml='config_base_enca.yaml', constraints=None, continue_once=None, cpu=False, cpu_offload=False, criterion='cross_entropy', curriculum=0, data='/LocalData/dataset/CommonVoice/v4/en/en-ca', data_buffer_size=10, dataset_impl=None, ddp_backend='pytorch_ddp', ddp_comm_hook='none', decoding_format=None, device_id=0, disable_validation=False, distributed_backend='nccl', distributed_init_method=None, distributed_no_spawn=False, distributed_num_procs=1, distributed_port=-1, distributed_rank=0, distributed_world_size=1, diverse_beam_groups=-1, diverse_beam_strength=0.5, diversity_rate=-1.0, empty_cache_freq=0, fast_stat_sync=False, find_unused_parameters=False, finetune_from_model=None, fix_batches_to_gpus=False, fixed_validation_seed=None, force_anneal=None, fp16=False, fp16_init_scale=128, fp16_no_flatten_grads=False, fp16_scale_tolerance=0.0, fp16_scale_window=None, fp32_reduce_scatter=False, gen_subset='test_st_en_ca_local', gradient_as_bucket_view=False, grouped_shuffling=False, heartbeat_timeout=-1, ignore_unused_valid_subsets=False, iter_decode_eos_penalty=0.0, iter_decode_force_max_iter=False, iter_decode_max_iter=10, iter_decode_with_beam=1, iter_decode_with_external_reranker=False, keep_best_checkpoints=-1, keep_interval_updates=-1, keep_interval_updates_pattern=-1, keep_last_epochs=-1, lenpen=1.0, lm_path=None, lm_weight=0.0, load_checkpoint_on_all_dp_ranks=False, localsgd_frequency=3, log_file=None, log_format=None, log_interval=100, lr_scheduler='fixed', lr_shrink=0.1, match_source_len=False, max_len_a=0.0, max_len_b=512, max_source_positions=2300000, max_target_positions=1024, max_tokens=2300000, max_tokens_valid=2300000, max_valid_steps=None, maximize_best_checkpoint_metric=False, memory_efficient_bf16=False, memory_efficient_fp16=False, min_len=1, min_loss_scale=0.0001, model_overrides="{'w2v_path':'/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm/config/pretrain/speechlmp_base_cfg.pt'}", model_parallel_size=1, nbest=1, no_beamable_mm=False, no_early_stop=False, no_epoch_checkpoints=False, no_last_checkpoints=False, no_progress_bar=False, no_repeat_ngram_size=0, no_reshard_after_forward=False, no_save=False, no_save_optimizer_state=False, no_seed_provided=False, not_fsdp_flatten_parameters=False, nprocs_per_node=1, num_shards=1, num_workers=0, on_cpu_convert_precision=False, optimizer=None, optimizer_overrides='{}', path='/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enca_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt', patience=-1, pipeline_balance=None, pipeline_checkpoint='never', pipeline_chunks=0, pipeline_decoder_balance=None, pipeline_decoder_devices=None, pipeline_devices=None, pipeline_encoder_balance=None, pipeline_encoder_devices=None, pipeline_model_parallel=False, plasma_path='/tmp/plasma', post_process=None, prefix_size=0, print_alignment=None, print_step=False, profile=False, quantization_config_path=None, quiet=False, replace_unk=None, required_batch_size_multiple=8, required_seq_len_multiple=1, reset_dataloader=False, reset_logging=False, reset_lr_scheduler=False, reset_meters=False, reset_optimizer=False, restore_file='checkpoint_last.pt', results_path='/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enca_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test', retain_dropout=False, retain_dropout_modules=None, retain_iter_history=False, sacrebleu=False, sacrebleu_char_level=False, sacrebleu_lowercase=False, sacrebleu_tokenizer='13a', sampling=False, sampling_topk=-1, sampling_topp=-1.0, save_dir='checkpoints', save_interval=1, save_interval_updates=0, score_reference=False, scoring='sacrebleu', seed=1, shard_id=0, simul_type=None, skip_invalid_size_inputs_valid_test=False, slowmo_base_algorithm='localsgd', slowmo_momentum=None, suppress_crashes=False, task='speech_to_text', temperature=1.0, tensorboard_logdir=None, threshold_loss_scale=None, tokenizer=None, tpu=False, train_subset='train', unkpen=0, unnormalized=False, update_epoch_batch_itr=False, update_ordered_indices_seed=False, use_plasma_view=False, use_sharded_state=False, user_dir='/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm', valid_subset='valid', validate_after_updates=0, validate_interval=1, validate_interval_updates=0, wandb_project=None, warmup_updates=0, write_checkpoints_asynchronously=False, zero_sharding='none'), 'criterion': {'_name': 'cross_entropy', 'sentence_avg': True}, 'optimizer': None, 'lr_scheduler': {'_name': 'fixed', 'force_anneal': None, 'lr_shrink': 0.1, 'warmup_updates': 0, 'lr': [0.25]}, 'scoring': {'_name': 'sacrebleu', 'sacrebleu_tokenizer': '13a', 'sacrebleu_lowercase': False, 'sacrebleu_char_level': False}, 'bpe': None, 'tokenizer': None, 'ema': {'_name': None, 'store_ema': False, 'ema_decay': 0.9999, 'ema_start_update': 0, 'ema_seed_model': None, 'ema_update_freq': 1, 'ema_fp32': False}, 'simul_type': None}
2023-06-05 13:17:09 | INFO | fairseq.tasks.speech_to_text | dictionary size (spm_char_st_en_ca.txt): 171
2023-06-05 13:17:09 | INFO | fairseq_cli.generate | loading model(s) from /home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enca_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt
2023-06-05 13:17:18 | INFO | speechlm.tasks.joint_sc2t_pretrain | current directory is /home/ziqzhang/code/SpeechT5/SpeechLM
2023-06-05 13:17:18 | INFO | speechlm.tasks.joint_sc2t_pretrain | JSTPretrainingTask Config {'_name': 'joint_sc2t_pretraining', 'data': '/LocalData/dataset/CommonVoice/v4/en/en-ca', 'fine_tuning': False, 'labels': ['phn'], 'label_dir': '/home/ziqzhang/code/SpeechT5/SpeechLM/dataset/LibriSpeech/phone_unit', 'label_rate': 100, 'sample_rate': 16000, 'normalize': False, 'enable_padding': False, 'max_keep_size': None, 'max_sample_size': 250000, 'min_sample_size': 32000, 'single_target': False, 'random_crop': True, 'pad_audio': False, 'store_labels': True, 'add_decoder_target': False, 'split_modality_batch': False, 'speech_tgt_lang': '', 'speech_sampling_alpha': 0.2, 'text_sampling_alpha': 0.2, 'hubert_tokenizer': none, 'sp_path': None, 'text_cfg': {'_name': None, 'text_data': '/home/ziqzhang/code/SpeechT5/SpeechLM/dataset/LibriLM/phone_unit/bin-idx', 'seed': 1337, 'tokens_per_sample': 1024, 'tokens_per_sample_tgt': 512, 'sample_break_mode': 'eos', 'mask': 0.3, 'leave_unmasked_prob': 0.1, 'mask_random': 0.1, 'freq_weighted_replacement': False, 'mask_whole_words': True, 'mask_repeative_tokens': True, 'mask_multiple_length': 1, 'mask_stdev': 0.0, 'shorten_method': 'random_crop', 'shorten_data_split_list': '', 'insert': 0.0, 'permute': 0.0, 'rotate': 0.0, 'poisson_lambda': 3.5, 'permute_sentences': 0.0, 'mask_length': '10', 'replace_length': 1, 'shuffle_instance': False, 'max_source_positions': 1024, 'max_target_positions': 1024, 'bpe': '', 'data_config': 'config.yaml', 'text_maxtokens_ratio': 1.0, 'prepend_tgt_lang_tag': False, 'mask_text_ratio': 0.0, 'truncate_mono_source': True}}
2023-06-05 13:17:18 | INFO | speechlm.models.speechlm | SpeechlmModel Config: {'_name': 'speechlm', 'label_rate': 100, 'extractor_mode': default, 'encoder_layers': 6, 'encoder_embed_dim': 768, 'encoder_ffn_embed_dim': 3072, 'encoder_attention_heads': 8, 'activation_fn': gelu, 'layer_type': transformer, 'dropout': 0.0, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'encoder_layerdrop': 0.1, 'dropout_input': 0.0, 'dropout_features': 0.1, 'final_dim': 256, 'untie_final_proj': True, 'layer_norm_first': False, 'conv_feature_layers': '[(512,10,5)] + [(512,3,2)] * 4 + [(512,2,2)] * 2', 'conv_bias': False, 'logit_temp': 0.1, 'target_glu': False, 'feature_grad_mult': 1.0, 'mask_length': 10, 'mask_prob': 0.5, 'mask_selection': static, 'mask_other': 0.0, 'no_mask_overlap': False, 'mask_min_space': 1, 'mask_channel_length': 10, 'mask_channel_prob': 0.0, 'mask_channel_selection': static, 'mask_channel_other': 0.0, 'no_mask_channel_overlap': False, 'mask_channel_min_space': 1, 'conv_pos': 128, 'conv_pos_groups': 16, 'latent_temp': [2.0, 0.5, 0.999995], 'skip_masked': False, 'skip_nomask': False, 'checkpoint_activations': False, 'required_seq_len_multiple': 2, 'depthwise_conv_kernel_size': 31, 'attn_type': '', 'pos_enc_type': 'abs', 'fp16': False, 'use_rel_pos_enc': True, 'scaling_for_att': 1.0, 'text_transformer': {'_name': None, 'activation_fn': gelu, 'dropout': 0.0, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'adaptive_input': False, 'encoder': {'_name': None, 'embed_path': None, 'embed_dim': 768, 'ffn_embed_dim': 3072, 'layers': 6, 'attention_heads': 8, 'normalize_before': False, 'learned_pos': True, 'layerdrop': 0.1, 'layers_to_keep': None}, 'max_source_positions': 3000, 'decoder': {'_name': None, 'embed_path': None, 'embed_dim': 512, 'ffn_embed_dim': 2048, 'layers': 6, 'attention_heads': 8, 'normalize_before': False, 'learned_pos': False, 'layerdrop': 0.0, 'layers_to_keep': None, 'input_dim': 512, 'output_dim': 512}, 'max_target_positions': 1024, 'share_decoder_input_output_embed': False, 'share_all_embeddings': False, 'no_token_positional_embeddings': False, 'adaptive_softmax_cutoff': None, 'adaptive_softmax_dropout': 0.0, 'adaptive_softmax_factor': 4.0, 'layernorm_embedding': True, 'tie_adaptive_weights': False, 'tie_adaptive_proj': False, 'no_scale_embedding': True, 'checkpoint_activations': False, 'offload_activations': False, 'no_cross_attention': False, 'cross_self_attention': False, 'quant_noise': {'_name': None, 'pq': 0.0, 'pq_block_size': 8, 'scalar': 0.0}, 'min_params_to_wrap': 100000000, 'char_inputs': False, 'relu_dropout': 0.0, 'base_layers': 0, 'base_sublayers': 1, 'base_shuffle': 1, 'export': False, 'no_decoder_final_norm': False}, 'add_unit_encoder': True, 'add_decoder': False, 'add_text_ctc': True, 'text_ctc_conv_kernel': 2, 'mask_u2t': True, 'compute_mum': False, 'mix_with_unit': True, 'use_pred_unit': False, 'l2_embedding': False, 'encoder_dict_size': -1, 'decoder_dict_size': -1}
2023-06-05 13:17:21 | INFO | fairseq.tasks.speech_to_text | pre-tokenizer: {'tokenizer': None}
2023-06-05 13:17:21 | INFO | fairseq.tasks.speech_to_text | tokenizer: {'bpe': 'sentencepiece', 'sentencepiece_model': '/LocalData/dataset/CommonVoice/v4/en/en-ca/spm_char_st_en_ca.model'}
2023-06-05 13:17:22 | INFO | fairseq.data.audio.speech_to_text_dataset | 'test_st_en_ca_local' has 0.00% OOV
2023-06-05 13:17:22 | INFO | fairseq.data.audio.speech_to_text_dataset | SpeechToTextDataset(split="test_st_en_ca_local", n_samples=15_530, prepend_tgt_lang_tag=False, shuffle=False, transforms=None, n_frames_per_step=1
2023-06-05 13:17:24 | INFO | fairseq.tasks.speech_to_text | pre-tokenizer: {'tokenizer': None}
2023-06-05 13:17:24 | INFO | fairseq.tasks.speech_to_text | tokenizer: {'bpe': 'sentencepiece', 'sentencepiece_model': '/LocalData/dataset/CommonVoice/v4/en/en-ca/spm_char_st_en_ca.model'}
2023-06-05 13:20:05 | INFO | fairseq.logging.progress_bar | :    101 / 775 wps=359
2023-06-05 13:23:06 | INFO | fairseq.logging.progress_bar | :    201 / 775 wps=471
2023-06-05 13:25:51 | INFO | fairseq.logging.progress_bar | :    301 / 775 wps=550
2023-06-05 13:28:33 | INFO | fairseq.logging.progress_bar | :    401 / 775 wps=582
2023-06-05 13:31:10 | INFO | fairseq.logging.progress_bar | :    501 / 775 wps=620
2023-06-05 13:33:53 | INFO | fairseq.logging.progress_bar | :    601 / 775 wps=652
2023-06-05 13:36:11 | INFO | fairseq.logging.progress_bar | :    701 / 775 wps=689
2023-06-05 13:37:33 | INFO | fairseq_cli.generate | NOTE: hypothesis and token scores are output in base 2
2023-06-05 13:37:33 | INFO | fairseq_cli.generate | Translated 15,530 sentences (872,319 tokens) in 1141.3s (13.61 sentences/s, 764.33 tokens/s)
/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_enca_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test
Generate test_st_en_ca_local with beam=5: BLEU = 31.01 60.1/36.9/25.1/17.2 (BP = 0.991 ratio = 0.991 hyp_len = 169446 ref_len = 170981)
2023-06-05 13:37:40 | INFO | fairseq_cli.generate | {'_name': None, 'common': {'_name': None, 'no_progress_bar': False, 'log_interval': 100, 'log_format': None, 'log_file': None, 'tensorboard_logdir': None, 'wandb_project': None, 'azureml_logging': False, 'seed': 1, 'cpu': False, 'tpu': False, 'bf16': False, 'memory_efficient_bf16': False, 'fp16': False, 'memory_efficient_fp16': False, 'fp16_no_flatten_grads': False, 'fp16_init_scale': 128, 'fp16_scale_window': None, 'fp16_scale_tolerance': 0.0, 'on_cpu_convert_precision': False, 'min_loss_scale': 0.0001, 'threshold_loss_scale': None, 'amp': False, 'amp_batch_retries': 2, 'amp_init_scale': 128, 'amp_scale_window': None, 'user_dir': '/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm', 'empty_cache_freq': 0, 'all_gather_list_size': 16384, 'model_parallel_size': 1, 'quantization_config_path': None, 'profile': False, 'reset_logging': False, 'suppress_crashes': False, 'use_plasma_view': False, 'plasma_path': '/tmp/plasma'}, 'common_eval': {'_name': None, 'path': '/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_ende_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt', 'post_process': None, 'quiet': False, 'model_overrides': "{'w2v_path':'/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm/config/pretrain/speechlmp_base_cfg.pt'}", 'results_path': '/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_ende_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test'}, 'distributed_training': {'_name': None, 'distributed_world_size': 1, 'distributed_num_procs': 1, 'distributed_rank': 0, 'distributed_backend': 'nccl', 'distributed_init_method': None, 'distributed_port': -1, 'device_id': 0, 'distributed_no_spawn': False, 'ddp_backend': 'pytorch_ddp', 'ddp_comm_hook': 'none', 'bucket_cap_mb': 25, 'fix_batches_to_gpus': False, 'find_unused_parameters': False, 'gradient_as_bucket_view': False, 'fast_stat_sync': False, 'heartbeat_timeout': -1, 'broadcast_buffers': False, 'slowmo_momentum': None, 'slowmo_base_algorithm': 'localsgd', 'localsgd_frequency': 3, 'nprocs_per_node': 1, 'pipeline_model_parallel': False, 'pipeline_balance': None, 'pipeline_devices': None, 'pipeline_chunks': 0, 'pipeline_encoder_balance': None, 'pipeline_encoder_devices': None, 'pipeline_decoder_balance': None, 'pipeline_decoder_devices': None, 'pipeline_checkpoint': 'never', 'zero_sharding': 'none', 'fp16': False, 'memory_efficient_fp16': False, 'tpu': False, 'no_reshard_after_forward': False, 'fp32_reduce_scatter': False, 'cpu_offload': False, 'use_sharded_state': False, 'not_fsdp_flatten_parameters': False}, 'dataset': {'_name': None, 'num_workers': 4, 'skip_invalid_size_inputs_valid_test': False, 'max_tokens': 2300000, 'batch_size': None, 'required_batch_size_multiple': 8, 'required_seq_len_multiple': 1, 'dataset_impl': None, 'data_buffer_size': 10, 'train_subset': 'train', 'valid_subset': 'valid', 'combine_valid_subsets': None, 'ignore_unused_valid_subsets': False, 'validate_interval': 1, 'validate_interval_updates': 0, 'validate_after_updates': 0, 'fixed_validation_seed': None, 'disable_validation': False, 'max_tokens_valid': 2300000, 'batch_size_valid': None, 'max_valid_steps': None, 'curriculum': 0, 'gen_subset': 'test_st_en_de_local', 'num_shards': 1, 'shard_id': 0, 'grouped_shuffling': False, 'update_epoch_batch_itr': False, 'update_ordered_indices_seed': False}, 'optimization': {'_name': None, 'max_epoch': 0, 'max_update': 0, 'stop_time_hours': 0.0, 'clip_norm': 0.0, 'sentence_avg': False, 'update_freq': [1], 'lr': [0.25], 'stop_min_lr': -1.0, 'use_bmuf': False, 'skip_remainder_batch': False}, 'checkpoint': {'_name': None, 'save_dir': 'checkpoints', 'restore_file': 'checkpoint_last.pt', 'continue_once': None, 'finetune_from_model': None, 'reset_dataloader': False, 'reset_lr_scheduler': False, 'reset_meters': False, 'reset_optimizer': False, 'optimizer_overrides': '{}', 'save_interval': 1, 'save_interval_updates': 0, 'keep_interval_updates': -1, 'keep_interval_updates_pattern': -1, 'keep_last_epochs': -1, 'keep_best_checkpoints': -1, 'no_save': False, 'no_epoch_checkpoints': False, 'no_last_checkpoints': False, 'no_save_optimizer_state': False, 'best_checkpoint_metric': 'loss', 'maximize_best_checkpoint_metric': False, 'patience': -1, 'checkpoint_suffix': '', 'checkpoint_shard_count': 1, 'load_checkpoint_on_all_dp_ranks': False, 'write_checkpoints_asynchronously': False, 'model_parallel_size': 1}, 'bmuf': {'_name': None, 'block_lr': 1.0, 'block_momentum': 0.875, 'global_sync_iter': 50, 'warmup_iterations': 500, 'use_nbm': False, 'average_sync': False, 'distributed_world_size': 1}, 'generation': {'_name': None, 'beam': 5, 'nbest': 1, 'max_len_a': 0.0, 'max_len_b': 512, 'min_len': 1, 'match_source_len': False, 'unnormalized': False, 'no_early_stop': False, 'no_beamable_mm': False, 'lenpen': 1.0, 'unkpen': 0.0, 'replace_unk': None, 'sacrebleu': False, 'score_reference': False, 'prefix_size': 0, 'no_repeat_ngram_size': 0, 'sampling': False, 'sampling_topk': -1, 'sampling_topp': -1.0, 'constraints': None, 'temperature': 1.0, 'diverse_beam_groups': -1, 'diverse_beam_strength': 0.5, 'diversity_rate': -1.0, 'print_alignment': None, 'print_step': False, 'lm_path': None, 'lm_weight': 0.0, 'iter_decode_eos_penalty': 0.0, 'iter_decode_max_iter': 10, 'iter_decode_force_max_iter': False, 'iter_decode_with_beam': 1, 'iter_decode_with_external_reranker': False, 'retain_iter_history': False, 'retain_dropout': False, 'retain_dropout_modules': None, 'decoding_format': None, 'no_seed_provided': False}, 'eval_lm': {'_name': None, 'output_word_probs': False, 'output_word_stats': False, 'context_window': 0, 'softmax_batch': 9223372036854775807}, 'interactive': {'_name': None, 'buffer_size': 0, 'input': '-'}, 'model': {'_name': 'wav2vec2', 'extractor_mode': 'default', 'encoder_layers': 12, 'encoder_embed_dim': 768, 'encoder_ffn_embed_dim': 3072, 'encoder_attention_heads': 12, 'activation_fn': 'gelu', 'layer_type': 'transformer', 'dropout': 0.1, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'encoder_layerdrop': 0.0, 'dropout_input': 0.0, 'dropout_features': 0.0, 'final_dim': 0, 'layer_norm_first': False, 'conv_feature_layers': '[(512, 10, 5)] + [(512, 3, 2)] * 4 + [(512,2,2)] + [(512,2,2)]', 'conv_bias': False, 'logit_temp': 0.1, 'quantize_targets': False, 'quantize_input': False, 'same_quantizer': False, 'target_glu': False, 'feature_grad_mult': 1.0, 'quantizer_depth': 1, 'quantizer_factor': 3, 'latent_vars': 320, 'latent_groups': 2, 'latent_dim': 0, 'mask_length': 10, 'mask_prob': 0.65, 'mask_selection': 'static', 'mask_other': 0.0, 'no_mask_overlap': False, 'mask_min_space': 1, 'require_same_masks': True, 'mask_dropout': 0.0, 'mask_channel_length': 10, 'mask_channel_prob': 0.0, 'mask_channel_before': False, 'mask_channel_selection': 'static', 'mask_channel_other': 0.0, 'no_mask_channel_overlap': False, 'mask_channel_min_space': 1, 'num_negatives': 100, 'negatives_from_everywhere': False, 'cross_sample_negatives': 0, 'codebook_negatives': 0, 'conv_pos': 128, 'conv_pos_groups': 16, 'pos_conv_depth': 1, 'latent_temp': [2.0, 0.5, 0.999995], 'max_positions': 100000, 'checkpoint_activations': False, 'required_seq_len_multiple': 1, 'crop_seq_to_multiple': 1, 'depthwise_conv_kernel_size': 31, 'attn_type': '', 'pos_enc_type': 'abs', 'fp16': False}, 'task': Namespace(_name='speech_to_text', all_gather_list_size=16384, amp=False, amp_batch_retries=2, amp_init_scale=128, amp_scale_window=None, arch='wav2vec2', azureml_logging=False, batch_size=None, batch_size_valid=None, beam=5, best_checkpoint_metric='loss', bf16=False, bpe=None, broadcast_buffers=False, bucket_cap_mb=25, checkpoint_shard_count=1, checkpoint_suffix='', combine_valid_subsets=None, config_yaml='config_base_ende.yaml', constraints=None, continue_once=None, cpu=False, cpu_offload=False, criterion='cross_entropy', curriculum=0, data='/LocalData/dataset/CommonVoice/v4/en/en-de', data_buffer_size=10, dataset_impl=None, ddp_backend='pytorch_ddp', ddp_comm_hook='none', decoding_format=None, device_id=0, disable_validation=False, distributed_backend='nccl', distributed_init_method=None, distributed_no_spawn=False, distributed_num_procs=1, distributed_port=-1, distributed_rank=0, distributed_world_size=1, diverse_beam_groups=-1, diverse_beam_strength=0.5, diversity_rate=-1.0, empty_cache_freq=0, fast_stat_sync=False, find_unused_parameters=False, finetune_from_model=None, fix_batches_to_gpus=False, fixed_validation_seed=None, force_anneal=None, fp16=False, fp16_init_scale=128, fp16_no_flatten_grads=False, fp16_scale_tolerance=0.0, fp16_scale_window=None, fp32_reduce_scatter=False, gen_subset='test_st_en_de_local', gradient_as_bucket_view=False, grouped_shuffling=False, heartbeat_timeout=-1, ignore_unused_valid_subsets=False, iter_decode_eos_penalty=0.0, iter_decode_force_max_iter=False, iter_decode_max_iter=10, iter_decode_with_beam=1, iter_decode_with_external_reranker=False, keep_best_checkpoints=-1, keep_interval_updates=-1, keep_interval_updates_pattern=-1, keep_last_epochs=-1, lenpen=1.0, lm_path=None, lm_weight=0.0, load_checkpoint_on_all_dp_ranks=False, localsgd_frequency=3, log_file=None, log_format=None, log_interval=100, lr_scheduler='fixed', lr_shrink=0.1, match_source_len=False, max_len_a=0.0, max_len_b=512, max_source_positions=2300000, max_target_positions=1024, max_tokens=2300000, max_tokens_valid=2300000, max_valid_steps=None, maximize_best_checkpoint_metric=False, memory_efficient_bf16=False, memory_efficient_fp16=False, min_len=1, min_loss_scale=0.0001, model_overrides="{'w2v_path':'/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm/config/pretrain/speechlmp_base_cfg.pt'}", model_parallel_size=1, nbest=1, no_beamable_mm=False, no_early_stop=False, no_epoch_checkpoints=False, no_last_checkpoints=False, no_progress_bar=False, no_repeat_ngram_size=0, no_reshard_after_forward=False, no_save=False, no_save_optimizer_state=False, no_seed_provided=False, not_fsdp_flatten_parameters=False, nprocs_per_node=1, num_shards=1, num_workers=4, on_cpu_convert_precision=False, optimizer=None, optimizer_overrides='{}', path='/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_ende_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt', patience=-1, pipeline_balance=None, pipeline_checkpoint='never', pipeline_chunks=0, pipeline_decoder_balance=None, pipeline_decoder_devices=None, pipeline_devices=None, pipeline_encoder_balance=None, pipeline_encoder_devices=None, pipeline_model_parallel=False, plasma_path='/tmp/plasma', post_process=None, prefix_size=0, print_alignment=None, print_step=False, profile=False, quantization_config_path=None, quiet=False, replace_unk=None, required_batch_size_multiple=8, required_seq_len_multiple=1, reset_dataloader=False, reset_logging=False, reset_lr_scheduler=False, reset_meters=False, reset_optimizer=False, restore_file='checkpoint_last.pt', results_path='/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_ende_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test', retain_dropout=False, retain_dropout_modules=None, retain_iter_history=False, sacrebleu=False, sacrebleu_char_level=False, sacrebleu_lowercase=False, sacrebleu_tokenizer='13a', sampling=False, sampling_topk=-1, sampling_topp=-1.0, save_dir='checkpoints', save_interval=1, save_interval_updates=0, score_reference=False, scoring='sacrebleu', seed=1, shard_id=0, simul_type=None, skip_invalid_size_inputs_valid_test=False, slowmo_base_algorithm='localsgd', slowmo_momentum=None, suppress_crashes=False, task='speech_to_text', temperature=1.0, tensorboard_logdir=None, threshold_loss_scale=None, tokenizer=None, tpu=False, train_subset='train', unkpen=0, unnormalized=False, update_epoch_batch_itr=False, update_ordered_indices_seed=False, use_plasma_view=False, use_sharded_state=False, user_dir='/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm', valid_subset='valid', validate_after_updates=0, validate_interval=1, validate_interval_updates=0, wandb_project=None, warmup_updates=0, write_checkpoints_asynchronously=False, zero_sharding='none'), 'criterion': {'_name': 'cross_entropy', 'sentence_avg': True}, 'optimizer': None, 'lr_scheduler': {'_name': 'fixed', 'force_anneal': None, 'lr_shrink': 0.1, 'warmup_updates': 0, 'lr': [0.25]}, 'scoring': {'_name': 'sacrebleu', 'sacrebleu_tokenizer': '13a', 'sacrebleu_lowercase': False, 'sacrebleu_char_level': False}, 'bpe': None, 'tokenizer': None, 'ema': {'_name': None, 'store_ema': False, 'ema_decay': 0.9999, 'ema_start_update': 0, 'ema_seed_model': None, 'ema_update_freq': 1, 'ema_fp32': False}, 'simul_type': None}
2023-06-05 13:37:40 | INFO | fairseq.tasks.speech_to_text | dictionary size (spm_char_st_en_de.txt): 168
2023-06-05 13:37:40 | INFO | fairseq_cli.generate | loading model(s) from /home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_ende_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt
2023-06-05 13:37:49 | INFO | speechlm.tasks.joint_sc2t_pretrain | current directory is /home/ziqzhang/code/SpeechT5/SpeechLM
2023-06-05 13:37:49 | INFO | speechlm.tasks.joint_sc2t_pretrain | JSTPretrainingTask Config {'_name': 'joint_sc2t_pretraining', 'data': '/LocalData/dataset/CommonVoice/v4/en/en-de', 'fine_tuning': False, 'labels': ['phn'], 'label_dir': '/home/ziqzhang/code/SpeechT5/SpeechLM/dataset/LibriSpeech/phone_unit', 'label_rate': 100, 'sample_rate': 16000, 'normalize': False, 'enable_padding': False, 'max_keep_size': None, 'max_sample_size': 250000, 'min_sample_size': 32000, 'single_target': False, 'random_crop': True, 'pad_audio': False, 'store_labels': True, 'add_decoder_target': False, 'split_modality_batch': False, 'speech_tgt_lang': '', 'speech_sampling_alpha': 0.2, 'text_sampling_alpha': 0.2, 'hubert_tokenizer': none, 'sp_path': None, 'text_cfg': {'_name': None, 'text_data': '/home/ziqzhang/code/SpeechT5/SpeechLM/dataset/LibriLM/phone_unit/bin-idx', 'seed': 1337, 'tokens_per_sample': 1024, 'tokens_per_sample_tgt': 512, 'sample_break_mode': 'eos', 'mask': 0.3, 'leave_unmasked_prob': 0.1, 'mask_random': 0.1, 'freq_weighted_replacement': False, 'mask_whole_words': True, 'mask_repeative_tokens': True, 'mask_multiple_length': 1, 'mask_stdev': 0.0, 'shorten_method': 'random_crop', 'shorten_data_split_list': '', 'insert': 0.0, 'permute': 0.0, 'rotate': 0.0, 'poisson_lambda': 3.5, 'permute_sentences': 0.0, 'mask_length': '10', 'replace_length': 1, 'shuffle_instance': False, 'max_source_positions': 1024, 'max_target_positions': 1024, 'bpe': '', 'data_config': 'config.yaml', 'text_maxtokens_ratio': 1.0, 'prepend_tgt_lang_tag': False, 'mask_text_ratio': 0.0, 'truncate_mono_source': True}}
2023-06-05 13:37:49 | INFO | speechlm.models.speechlm | SpeechlmModel Config: {'_name': 'speechlm', 'label_rate': 100, 'extractor_mode': default, 'encoder_layers': 6, 'encoder_embed_dim': 768, 'encoder_ffn_embed_dim': 3072, 'encoder_attention_heads': 8, 'activation_fn': gelu, 'layer_type': transformer, 'dropout': 0.0, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'encoder_layerdrop': 0.1, 'dropout_input': 0.0, 'dropout_features': 0.1, 'final_dim': 256, 'untie_final_proj': True, 'layer_norm_first': False, 'conv_feature_layers': '[(512,10,5)] + [(512,3,2)] * 4 + [(512,2,2)] * 2', 'conv_bias': False, 'logit_temp': 0.1, 'target_glu': False, 'feature_grad_mult': 1.0, 'mask_length': 10, 'mask_prob': 0.5, 'mask_selection': static, 'mask_other': 0.0, 'no_mask_overlap': False, 'mask_min_space': 1, 'mask_channel_length': 10, 'mask_channel_prob': 0.0, 'mask_channel_selection': static, 'mask_channel_other': 0.0, 'no_mask_channel_overlap': False, 'mask_channel_min_space': 1, 'conv_pos': 128, 'conv_pos_groups': 16, 'latent_temp': [2.0, 0.5, 0.999995], 'skip_masked': False, 'skip_nomask': False, 'checkpoint_activations': False, 'required_seq_len_multiple': 2, 'depthwise_conv_kernel_size': 31, 'attn_type': '', 'pos_enc_type': 'abs', 'fp16': False, 'use_rel_pos_enc': True, 'scaling_for_att': 1.0, 'text_transformer': {'_name': None, 'activation_fn': gelu, 'dropout': 0.0, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'adaptive_input': False, 'encoder': {'_name': None, 'embed_path': None, 'embed_dim': 768, 'ffn_embed_dim': 3072, 'layers': 6, 'attention_heads': 8, 'normalize_before': False, 'learned_pos': True, 'layerdrop': 0.1, 'layers_to_keep': None}, 'max_source_positions': 3000, 'decoder': {'_name': None, 'embed_path': None, 'embed_dim': 512, 'ffn_embed_dim': 2048, 'layers': 6, 'attention_heads': 8, 'normalize_before': False, 'learned_pos': False, 'layerdrop': 0.0, 'layers_to_keep': None, 'input_dim': 512, 'output_dim': 512}, 'max_target_positions': 1024, 'share_decoder_input_output_embed': False, 'share_all_embeddings': False, 'no_token_positional_embeddings': False, 'adaptive_softmax_cutoff': None, 'adaptive_softmax_dropout': 0.0, 'adaptive_softmax_factor': 4.0, 'layernorm_embedding': True, 'tie_adaptive_weights': False, 'tie_adaptive_proj': False, 'no_scale_embedding': True, 'checkpoint_activations': False, 'offload_activations': False, 'no_cross_attention': False, 'cross_self_attention': False, 'quant_noise': {'_name': None, 'pq': 0.0, 'pq_block_size': 8, 'scalar': 0.0}, 'min_params_to_wrap': 100000000, 'char_inputs': False, 'relu_dropout': 0.0, 'base_layers': 0, 'base_sublayers': 1, 'base_shuffle': 1, 'export': False, 'no_decoder_final_norm': False}, 'add_unit_encoder': True, 'add_decoder': False, 'add_text_ctc': True, 'text_ctc_conv_kernel': 2, 'mask_u2t': True, 'compute_mum': False, 'mix_with_unit': True, 'use_pred_unit': False, 'l2_embedding': False, 'encoder_dict_size': -1, 'decoder_dict_size': -1}
2023-06-05 13:37:53 | INFO | fairseq.tasks.speech_to_text | pre-tokenizer: {'tokenizer': None}
2023-06-05 13:37:53 | INFO | fairseq.tasks.speech_to_text | tokenizer: {'bpe': 'sentencepiece', 'sentencepiece_model': '/LocalData/dataset/CommonVoice/v4/en/en-de/spm_char_st_en_de.model'}
2023-06-05 13:37:54 | INFO | fairseq.data.audio.speech_to_text_dataset | 'test_st_en_de_local' has 0.00% OOV
2023-06-05 13:37:54 | INFO | fairseq.data.audio.speech_to_text_dataset | SpeechToTextDataset(split="test_st_en_de_local", n_samples=15_530, prepend_tgt_lang_tag=False, shuffle=False, transforms=None, n_frames_per_step=1
2023-06-05 13:37:56 | INFO | fairseq.tasks.speech_to_text | pre-tokenizer: {'tokenizer': None}
2023-06-05 13:37:56 | INFO | fairseq.tasks.speech_to_text | tokenizer: {'bpe': 'sentencepiece', 'sentencepiece_model': '/LocalData/dataset/CommonVoice/v4/en/en-de/spm_char_st_en_de.model'}
2023-06-05 13:41:07 | INFO | fairseq.logging.progress_bar | :    101 / 775 wps=315
2023-06-05 13:44:14 | INFO | fairseq.logging.progress_bar | :    201 / 775 wps=447
2023-06-05 13:47:07 | INFO | fairseq.logging.progress_bar | :    301 / 775 wps=530
2023-06-05 13:49:49 | INFO | fairseq.logging.progress_bar | :    401 / 775 wps=574
2023-06-05 13:52:32 | INFO | fairseq.logging.progress_bar | :    501 / 775 wps=616
2023-06-05 13:55:03 | INFO | fairseq.logging.progress_bar | :    601 / 775 wps=663
2023-06-05 13:57:22 | INFO | fairseq.logging.progress_bar | :    701 / 775 wps=705
2023-06-05 13:58:50 | INFO | fairseq_cli.generate | NOTE: hypothesis and token scores are output in base 2
2023-06-05 13:58:50 | INFO | fairseq_cli.generate | Translated 15,530 sentences (930,714 tokens) in 1184.9s (13.11 sentences/s, 785.48 tokens/s)
/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_ende_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test
Generate test_st_en_de_local with beam=5: BLEU = 24.23 56.3/29.9/18.5/11.9 (BP = 0.982 ratio = 0.982 hyp_len = 161921 ref_len = 164867)
2023-06-05 13:58:57 | INFO | fairseq_cli.generate | {'_name': None, 'common': {'_name': None, 'no_progress_bar': False, 'log_interval': 100, 'log_format': None, 'log_file': None, 'tensorboard_logdir': None, 'wandb_project': None, 'azureml_logging': False, 'seed': 1, 'cpu': False, 'tpu': False, 'bf16': False, 'memory_efficient_bf16': False, 'fp16': False, 'memory_efficient_fp16': False, 'fp16_no_flatten_grads': False, 'fp16_init_scale': 128, 'fp16_scale_window': None, 'fp16_scale_tolerance': 0.0, 'on_cpu_convert_precision': False, 'min_loss_scale': 0.0001, 'threshold_loss_scale': None, 'amp': False, 'amp_batch_retries': 2, 'amp_init_scale': 128, 'amp_scale_window': None, 'user_dir': '/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm', 'empty_cache_freq': 0, 'all_gather_list_size': 16384, 'model_parallel_size': 1, 'quantization_config_path': None, 'profile': False, 'reset_logging': False, 'suppress_crashes': False, 'use_plasma_view': False, 'plasma_path': '/tmp/plasma'}, 'common_eval': {'_name': None, 'path': '/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_entr_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt', 'post_process': None, 'quiet': False, 'model_overrides': "{'w2v_path':'/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm/config/pretrain/speechlmp_base_cfg.pt'}", 'results_path': '/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_entr_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test'}, 'distributed_training': {'_name': None, 'distributed_world_size': 1, 'distributed_num_procs': 1, 'distributed_rank': 0, 'distributed_backend': 'nccl', 'distributed_init_method': None, 'distributed_port': -1, 'device_id': 0, 'distributed_no_spawn': False, 'ddp_backend': 'pytorch_ddp', 'ddp_comm_hook': 'none', 'bucket_cap_mb': 25, 'fix_batches_to_gpus': False, 'find_unused_parameters': False, 'gradient_as_bucket_view': False, 'fast_stat_sync': False, 'heartbeat_timeout': -1, 'broadcast_buffers': False, 'slowmo_momentum': None, 'slowmo_base_algorithm': 'localsgd', 'localsgd_frequency': 3, 'nprocs_per_node': 1, 'pipeline_model_parallel': False, 'pipeline_balance': None, 'pipeline_devices': None, 'pipeline_chunks': 0, 'pipeline_encoder_balance': None, 'pipeline_encoder_devices': None, 'pipeline_decoder_balance': None, 'pipeline_decoder_devices': None, 'pipeline_checkpoint': 'never', 'zero_sharding': 'none', 'fp16': False, 'memory_efficient_fp16': False, 'tpu': False, 'no_reshard_after_forward': False, 'fp32_reduce_scatter': False, 'cpu_offload': False, 'use_sharded_state': False, 'not_fsdp_flatten_parameters': False}, 'dataset': {'_name': None, 'num_workers': 4, 'skip_invalid_size_inputs_valid_test': False, 'max_tokens': 2300000, 'batch_size': None, 'required_batch_size_multiple': 8, 'required_seq_len_multiple': 1, 'dataset_impl': None, 'data_buffer_size': 10, 'train_subset': 'train', 'valid_subset': 'valid', 'combine_valid_subsets': None, 'ignore_unused_valid_subsets': False, 'validate_interval': 1, 'validate_interval_updates': 0, 'validate_after_updates': 0, 'fixed_validation_seed': None, 'disable_validation': False, 'max_tokens_valid': 2300000, 'batch_size_valid': None, 'max_valid_steps': None, 'curriculum': 0, 'gen_subset': 'test_st_en_tr_local', 'num_shards': 1, 'shard_id': 0, 'grouped_shuffling': False, 'update_epoch_batch_itr': False, 'update_ordered_indices_seed': False}, 'optimization': {'_name': None, 'max_epoch': 0, 'max_update': 0, 'stop_time_hours': 0.0, 'clip_norm': 0.0, 'sentence_avg': False, 'update_freq': [1], 'lr': [0.25], 'stop_min_lr': -1.0, 'use_bmuf': False, 'skip_remainder_batch': False}, 'checkpoint': {'_name': None, 'save_dir': 'checkpoints', 'restore_file': 'checkpoint_last.pt', 'continue_once': None, 'finetune_from_model': None, 'reset_dataloader': False, 'reset_lr_scheduler': False, 'reset_meters': False, 'reset_optimizer': False, 'optimizer_overrides': '{}', 'save_interval': 1, 'save_interval_updates': 0, 'keep_interval_updates': -1, 'keep_interval_updates_pattern': -1, 'keep_last_epochs': -1, 'keep_best_checkpoints': -1, 'no_save': False, 'no_epoch_checkpoints': False, 'no_last_checkpoints': False, 'no_save_optimizer_state': False, 'best_checkpoint_metric': 'loss', 'maximize_best_checkpoint_metric': False, 'patience': -1, 'checkpoint_suffix': '', 'checkpoint_shard_count': 1, 'load_checkpoint_on_all_dp_ranks': False, 'write_checkpoints_asynchronously': False, 'model_parallel_size': 1}, 'bmuf': {'_name': None, 'block_lr': 1.0, 'block_momentum': 0.875, 'global_sync_iter': 50, 'warmup_iterations': 500, 'use_nbm': False, 'average_sync': False, 'distributed_world_size': 1}, 'generation': {'_name': None, 'beam': 5, 'nbest': 1, 'max_len_a': 0.0, 'max_len_b': 512, 'min_len': 1, 'match_source_len': False, 'unnormalized': False, 'no_early_stop': False, 'no_beamable_mm': False, 'lenpen': 1.0, 'unkpen': 0.0, 'replace_unk': None, 'sacrebleu': False, 'score_reference': False, 'prefix_size': 0, 'no_repeat_ngram_size': 0, 'sampling': False, 'sampling_topk': -1, 'sampling_topp': -1.0, 'constraints': None, 'temperature': 1.0, 'diverse_beam_groups': -1, 'diverse_beam_strength': 0.5, 'diversity_rate': -1.0, 'print_alignment': None, 'print_step': False, 'lm_path': None, 'lm_weight': 0.0, 'iter_decode_eos_penalty': 0.0, 'iter_decode_max_iter': 10, 'iter_decode_force_max_iter': False, 'iter_decode_with_beam': 1, 'iter_decode_with_external_reranker': False, 'retain_iter_history': False, 'retain_dropout': False, 'retain_dropout_modules': None, 'decoding_format': None, 'no_seed_provided': False}, 'eval_lm': {'_name': None, 'output_word_probs': False, 'output_word_stats': False, 'context_window': 0, 'softmax_batch': 9223372036854775807}, 'interactive': {'_name': None, 'buffer_size': 0, 'input': '-'}, 'model': {'_name': 'wav2vec2', 'extractor_mode': 'default', 'encoder_layers': 12, 'encoder_embed_dim': 768, 'encoder_ffn_embed_dim': 3072, 'encoder_attention_heads': 12, 'activation_fn': 'gelu', 'layer_type': 'transformer', 'dropout': 0.1, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'encoder_layerdrop': 0.0, 'dropout_input': 0.0, 'dropout_features': 0.0, 'final_dim': 0, 'layer_norm_first': False, 'conv_feature_layers': '[(512, 10, 5)] + [(512, 3, 2)] * 4 + [(512,2,2)] + [(512,2,2)]', 'conv_bias': False, 'logit_temp': 0.1, 'quantize_targets': False, 'quantize_input': False, 'same_quantizer': False, 'target_glu': False, 'feature_grad_mult': 1.0, 'quantizer_depth': 1, 'quantizer_factor': 3, 'latent_vars': 320, 'latent_groups': 2, 'latent_dim': 0, 'mask_length': 10, 'mask_prob': 0.65, 'mask_selection': 'static', 'mask_other': 0.0, 'no_mask_overlap': False, 'mask_min_space': 1, 'require_same_masks': True, 'mask_dropout': 0.0, 'mask_channel_length': 10, 'mask_channel_prob': 0.0, 'mask_channel_before': False, 'mask_channel_selection': 'static', 'mask_channel_other': 0.0, 'no_mask_channel_overlap': False, 'mask_channel_min_space': 1, 'num_negatives': 100, 'negatives_from_everywhere': False, 'cross_sample_negatives': 0, 'codebook_negatives': 0, 'conv_pos': 128, 'conv_pos_groups': 16, 'pos_conv_depth': 1, 'latent_temp': [2.0, 0.5, 0.999995], 'max_positions': 100000, 'checkpoint_activations': False, 'required_seq_len_multiple': 1, 'crop_seq_to_multiple': 1, 'depthwise_conv_kernel_size': 31, 'attn_type': '', 'pos_enc_type': 'abs', 'fp16': False}, 'task': Namespace(_name='speech_to_text', all_gather_list_size=16384, amp=False, amp_batch_retries=2, amp_init_scale=128, amp_scale_window=None, arch='wav2vec2', azureml_logging=False, batch_size=None, batch_size_valid=None, beam=5, best_checkpoint_metric='loss', bf16=False, bpe=None, broadcast_buffers=False, bucket_cap_mb=25, checkpoint_shard_count=1, checkpoint_suffix='', combine_valid_subsets=None, config_yaml='config_base_entr.yaml', constraints=None, continue_once=None, cpu=False, cpu_offload=False, criterion='cross_entropy', curriculum=0, data='/LocalData/dataset/CommonVoice/v4/en/en-tr', data_buffer_size=10, dataset_impl=None, ddp_backend='pytorch_ddp', ddp_comm_hook='none', decoding_format=None, device_id=0, disable_validation=False, distributed_backend='nccl', distributed_init_method=None, distributed_no_spawn=False, distributed_num_procs=1, distributed_port=-1, distributed_rank=0, distributed_world_size=1, diverse_beam_groups=-1, diverse_beam_strength=0.5, diversity_rate=-1.0, empty_cache_freq=0, fast_stat_sync=False, find_unused_parameters=False, finetune_from_model=None, fix_batches_to_gpus=False, fixed_validation_seed=None, force_anneal=None, fp16=False, fp16_init_scale=128, fp16_no_flatten_grads=False, fp16_scale_tolerance=0.0, fp16_scale_window=None, fp32_reduce_scatter=False, gen_subset='test_st_en_tr_local', gradient_as_bucket_view=False, grouped_shuffling=False, heartbeat_timeout=-1, ignore_unused_valid_subsets=False, iter_decode_eos_penalty=0.0, iter_decode_force_max_iter=False, iter_decode_max_iter=10, iter_decode_with_beam=1, iter_decode_with_external_reranker=False, keep_best_checkpoints=-1, keep_interval_updates=-1, keep_interval_updates_pattern=-1, keep_last_epochs=-1, lenpen=1.0, lm_path=None, lm_weight=0.0, load_checkpoint_on_all_dp_ranks=False, localsgd_frequency=3, log_file=None, log_format=None, log_interval=100, lr_scheduler='fixed', lr_shrink=0.1, match_source_len=False, max_len_a=0.0, max_len_b=512, max_source_positions=2300000, max_target_positions=1024, max_tokens=2300000, max_tokens_valid=2300000, max_valid_steps=None, maximize_best_checkpoint_metric=False, memory_efficient_bf16=False, memory_efficient_fp16=False, min_len=1, min_loss_scale=0.0001, model_overrides="{'w2v_path':'/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm/config/pretrain/speechlmp_base_cfg.pt'}", model_parallel_size=1, nbest=1, no_beamable_mm=False, no_early_stop=False, no_epoch_checkpoints=False, no_last_checkpoints=False, no_progress_bar=False, no_repeat_ngram_size=0, no_reshard_after_forward=False, no_save=False, no_save_optimizer_state=False, no_seed_provided=False, not_fsdp_flatten_parameters=False, nprocs_per_node=1, num_shards=1, num_workers=4, on_cpu_convert_precision=False, optimizer=None, optimizer_overrides='{}', path='/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_entr_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt', patience=-1, pipeline_balance=None, pipeline_checkpoint='never', pipeline_chunks=0, pipeline_decoder_balance=None, pipeline_decoder_devices=None, pipeline_devices=None, pipeline_encoder_balance=None, pipeline_encoder_devices=None, pipeline_model_parallel=False, plasma_path='/tmp/plasma', post_process=None, prefix_size=0, print_alignment=None, print_step=False, profile=False, quantization_config_path=None, quiet=False, replace_unk=None, required_batch_size_multiple=8, required_seq_len_multiple=1, reset_dataloader=False, reset_logging=False, reset_lr_scheduler=False, reset_meters=False, reset_optimizer=False, restore_file='checkpoint_last.pt', results_path='/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_entr_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test', retain_dropout=False, retain_dropout_modules=None, retain_iter_history=False, sacrebleu=False, sacrebleu_char_level=False, sacrebleu_lowercase=False, sacrebleu_tokenizer='13a', sampling=False, sampling_topk=-1, sampling_topp=-1.0, save_dir='checkpoints', save_interval=1, save_interval_updates=0, score_reference=False, scoring='sacrebleu', seed=1, shard_id=0, simul_type=None, skip_invalid_size_inputs_valid_test=False, slowmo_base_algorithm='localsgd', slowmo_momentum=None, suppress_crashes=False, task='speech_to_text', temperature=1.0, tensorboard_logdir=None, threshold_loss_scale=None, tokenizer=None, tpu=False, train_subset='train', unkpen=0, unnormalized=False, update_epoch_batch_itr=False, update_ordered_indices_seed=False, use_plasma_view=False, use_sharded_state=False, user_dir='/home/ziqzhang/code/SpeechT5/SpeechLM/speechlm', valid_subset='valid', validate_after_updates=0, validate_interval=1, validate_interval_updates=0, wandb_project=None, warmup_updates=0, write_checkpoints_asynchronously=False, zero_sharding='none'), 'criterion': {'_name': 'cross_entropy', 'sentence_avg': True}, 'optimizer': None, 'lr_scheduler': {'_name': 'fixed', 'force_anneal': None, 'lr_shrink': 0.1, 'warmup_updates': 0, 'lr': [0.25]}, 'scoring': {'_name': 'sacrebleu', 'sacrebleu_tokenizer': '13a', 'sacrebleu_lowercase': False, 'sacrebleu_char_level': False}, 'bpe': None, 'tokenizer': None, 'ema': {'_name': None, 'store_ema': False, 'ema_decay': 0.9999, 'ema_start_update': 0, 'ema_seed_model': None, 'ema_update_freq': 1, 'ema_fp32': False}, 'simul_type': None}
2023-06-05 13:58:57 | INFO | fairseq.tasks.speech_to_text | dictionary size (spm_char_st_en_tr.txt): 173
2023-06-05 13:58:57 | INFO | fairseq_cli.generate | loading model(s) from /home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_entr_from_400k_bz3.2m_lr1e-4_seed1/checkpoint_best.pt
2023-06-05 13:58:59 | INFO | speechlm.tasks.joint_sc2t_pretrain | current directory is /home/ziqzhang/code/SpeechT5/SpeechLM
2023-06-05 13:58:59 | INFO | speechlm.tasks.joint_sc2t_pretrain | JSTPretrainingTask Config {'_name': 'joint_sc2t_pretraining', 'data': '/LocalData/dataset/CommonVoice/v4/en/en-tr', 'fine_tuning': False, 'labels': ['phn'], 'label_dir': '/home/ziqzhang/code/SpeechT5/SpeechLM/dataset/LibriSpeech/phone_unit', 'label_rate': 100, 'sample_rate': 16000, 'normalize': False, 'enable_padding': False, 'max_keep_size': None, 'max_sample_size': 250000, 'min_sample_size': 32000, 'single_target': False, 'random_crop': True, 'pad_audio': False, 'store_labels': True, 'add_decoder_target': False, 'split_modality_batch': False, 'speech_tgt_lang': '', 'speech_sampling_alpha': 0.2, 'text_sampling_alpha': 0.2, 'hubert_tokenizer': none, 'sp_path': None, 'text_cfg': {'_name': None, 'text_data': '/home/ziqzhang/code/SpeechT5/SpeechLM/dataset/LibriLM/phone_unit/bin-idx', 'seed': 1337, 'tokens_per_sample': 1024, 'tokens_per_sample_tgt': 512, 'sample_break_mode': 'eos', 'mask': 0.3, 'leave_unmasked_prob': 0.1, 'mask_random': 0.1, 'freq_weighted_replacement': False, 'mask_whole_words': True, 'mask_repeative_tokens': True, 'mask_multiple_length': 1, 'mask_stdev': 0.0, 'shorten_method': 'random_crop', 'shorten_data_split_list': '', 'insert': 0.0, 'permute': 0.0, 'rotate': 0.0, 'poisson_lambda': 3.5, 'permute_sentences': 0.0, 'mask_length': '10', 'replace_length': 1, 'shuffle_instance': False, 'max_source_positions': 1024, 'max_target_positions': 1024, 'bpe': '', 'data_config': 'config.yaml', 'text_maxtokens_ratio': 1.0, 'prepend_tgt_lang_tag': False, 'mask_text_ratio': 0.0, 'truncate_mono_source': True}}
2023-06-05 13:58:59 | INFO | speechlm.models.speechlm | SpeechlmModel Config: {'_name': 'speechlm', 'label_rate': 100, 'extractor_mode': default, 'encoder_layers': 6, 'encoder_embed_dim': 768, 'encoder_ffn_embed_dim': 3072, 'encoder_attention_heads': 8, 'activation_fn': gelu, 'layer_type': transformer, 'dropout': 0.0, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'encoder_layerdrop': 0.1, 'dropout_input': 0.0, 'dropout_features': 0.1, 'final_dim': 256, 'untie_final_proj': True, 'layer_norm_first': False, 'conv_feature_layers': '[(512,10,5)] + [(512,3,2)] * 4 + [(512,2,2)] * 2', 'conv_bias': False, 'logit_temp': 0.1, 'target_glu': False, 'feature_grad_mult': 1.0, 'mask_length': 10, 'mask_prob': 0.5, 'mask_selection': static, 'mask_other': 0.0, 'no_mask_overlap': False, 'mask_min_space': 1, 'mask_channel_length': 10, 'mask_channel_prob': 0.0, 'mask_channel_selection': static, 'mask_channel_other': 0.0, 'no_mask_channel_overlap': False, 'mask_channel_min_space': 1, 'conv_pos': 128, 'conv_pos_groups': 16, 'latent_temp': [2.0, 0.5, 0.999995], 'skip_masked': False, 'skip_nomask': False, 'checkpoint_activations': False, 'required_seq_len_multiple': 2, 'depthwise_conv_kernel_size': 31, 'attn_type': '', 'pos_enc_type': 'abs', 'fp16': False, 'use_rel_pos_enc': True, 'scaling_for_att': 1.0, 'text_transformer': {'_name': None, 'activation_fn': gelu, 'dropout': 0.0, 'attention_dropout': 0.1, 'activation_dropout': 0.0, 'adaptive_input': False, 'encoder': {'_name': None, 'embed_path': None, 'embed_dim': 768, 'ffn_embed_dim': 3072, 'layers': 6, 'attention_heads': 8, 'normalize_before': False, 'learned_pos': True, 'layerdrop': 0.1, 'layers_to_keep': None}, 'max_source_positions': 3000, 'decoder': {'_name': None, 'embed_path': None, 'embed_dim': 512, 'ffn_embed_dim': 2048, 'layers': 6, 'attention_heads': 8, 'normalize_before': False, 'learned_pos': False, 'layerdrop': 0.0, 'layers_to_keep': None, 'input_dim': 512, 'output_dim': 512}, 'max_target_positions': 1024, 'share_decoder_input_output_embed': False, 'share_all_embeddings': False, 'no_token_positional_embeddings': False, 'adaptive_softmax_cutoff': None, 'adaptive_softmax_dropout': 0.0, 'adaptive_softmax_factor': 4.0, 'layernorm_embedding': True, 'tie_adaptive_weights': False, 'tie_adaptive_proj': False, 'no_scale_embedding': True, 'checkpoint_activations': False, 'offload_activations': False, 'no_cross_attention': False, 'cross_self_attention': False, 'quant_noise': {'_name': None, 'pq': 0.0, 'pq_block_size': 8, 'scalar': 0.0}, 'min_params_to_wrap': 100000000, 'char_inputs': False, 'relu_dropout': 0.0, 'base_layers': 0, 'base_sublayers': 1, 'base_shuffle': 1, 'export': False, 'no_decoder_final_norm': False}, 'add_unit_encoder': True, 'add_decoder': False, 'add_text_ctc': True, 'text_ctc_conv_kernel': 2, 'mask_u2t': True, 'compute_mum': False, 'mix_with_unit': True, 'use_pred_unit': False, 'l2_embedding': False, 'encoder_dict_size': -1, 'decoder_dict_size': -1}
2023-06-05 13:59:02 | INFO | fairseq.tasks.speech_to_text | pre-tokenizer: {'tokenizer': None}
2023-06-05 13:59:02 | INFO | fairseq.tasks.speech_to_text | tokenizer: {'bpe': 'sentencepiece', 'sentencepiece_model': '/LocalData/dataset/CommonVoice/v4/en/en-tr/spm_char_st_en_tr.model'}
2023-06-05 13:59:03 | INFO | fairseq.data.audio.speech_to_text_dataset | 'test_st_en_tr_local' has 0.00% OOV
2023-06-05 13:59:03 | INFO | fairseq.data.audio.speech_to_text_dataset | SpeechToTextDataset(split="test_st_en_tr_local", n_samples=15_530, prepend_tgt_lang_tag=False, shuffle=False, transforms=None, n_frames_per_step=1
2023-06-05 13:59:05 | INFO | fairseq.tasks.speech_to_text | pre-tokenizer: {'tokenizer': None}
2023-06-05 13:59:05 | INFO | fairseq.tasks.speech_to_text | tokenizer: {'bpe': 'sentencepiece', 'sentencepiece_model': '/LocalData/dataset/CommonVoice/v4/en/en-tr/spm_char_st_en_tr.model'}
2023-06-05 14:01:22 | INFO | fairseq.logging.progress_bar | :    101 / 775 wps=375
2023-06-05 14:03:54 | INFO | fairseq.logging.progress_bar | :    201 / 775 wps=499
2023-06-05 14:06:21 | INFO | fairseq.logging.progress_bar | :    301 / 775 wps=569
2023-06-05 14:08:41 | INFO | fairseq.logging.progress_bar | :    401 / 775 wps=602
2023-06-05 14:10:59 | INFO | fairseq.logging.progress_bar | :    501 / 775 wps=641
2023-06-05 14:13:11 | INFO | fairseq.logging.progress_bar | :    601 / 775 wps=681
2023-06-05 14:15:11 | INFO | fairseq.logging.progress_bar | :    701 / 775 wps=719
2023-06-05 14:16:26 | INFO | fairseq_cli.generate | NOTE: hypothesis and token scores are output in base 2
2023-06-05 14:16:26 | INFO | fairseq_cli.generate | Translated 15,530 sentences (783,946 tokens) in 980.8s (15.83 sentences/s, 799.29 tokens/s)
/home/ziqzhang/data/speechlm_tri6bsemi_new/exp/finetune_covost/base_speechlmp_32gpu_1accum/legacy_entr_from_400k_bz3.2m_lr1e-4_seed1/decode_checkpoint_best_beam5/test
Generate test_st_en_tr_local with beam=5: BLEU = 16.19 49.0/22.3/11.9/6.6 (BP = 0.945 ratio = 0.946 hyp_len = 123520 ref_len = 130564)
